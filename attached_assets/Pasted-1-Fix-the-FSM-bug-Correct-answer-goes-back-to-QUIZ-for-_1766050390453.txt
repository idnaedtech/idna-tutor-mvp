1) Fix the FSM bug: “Correct answer goes back to QUIZ for retry”

In your log it says: “4 - Correct answer! Back to QUIZ for retry”
That’s wrong. Correct should move to EXPLAIN (next concept) or QUIZ (next question), not retry.

What to change in main.py

In your EVALUATE state, when answer is correct, change the transition to:

Option A (simple): QUIZ again but new question

Option B (better): go to EXPLAIN and then “next” triggers quiz

For MVP speed, do Option A:

Correct answer path should:

reset counters

pick a new question from DB for the same topic

set current_question_id to that new one

return “Correct. Next question: …” and stay in QUIZ

Pseudo:

# correct
new_q = asyncio.run(pick_question(topic_id))
asyncio.run(update_session(session_id,
    state="QUIZ",
    attempt_count=0,
    frustration_counter=0,
    current_question_id=new_q["question_id"]
))
return TurnResponse(... tutor_text=f"Correct. Next question: {new_q['prompt']}", next_state=QUIZ)

2) Make question rotation non-repeating (important)

Right now order by random() can repeat the same question again and again.

Easy MVP solution: add a seen_questions table

Run this in Supabase SQL Editor:

create table if not exists seen_questions (
  session_id text not null references sessions(session_id) on delete cascade,
  question_id text not null references questions(question_id) on delete cascade,
  created_at timestamptz not null default now(),
  primary key (session_id, question_id)
);


Then modify pick_question() to choose a question not in seen_questions for that session. If all seen, reset.

This makes the tutor feel “real” immediately.

3) Add “progress signal” in response (client UI needs it)

Update TurnResponse to include:

topic_id

question_id

title (concept title)

So your future Flutter app can show: “Grade 6 Math → Addition basics → Q2/3”.

This is simple: just add fields in proto, regenerate, and populate them.

4) Add a “Teacher Tool” script (so you don’t manually insert 500 rows)

You’re going to hit a wall if you insert questions by hand.

Build a simple script in Replit: teacher_tool.py

Input: plain text explanation
Output: inserts one concept + N questions into DB

For now, don’t use LLM. Just a CSV loader:

make content.csv with columns (topic_id, grade, subject, title, explain_text, question_id, prompt, answer_key, hint1, hint2, reveal_explain)

Then teacher_tool.py reads the CSV and inserts.

This is the fastest scalable workflow for a solo founder.

5) The next “product” step: a minimal web UI (not Flutter yet)

Before voice, build a tiny web textbox UI so you can test the tutor like a user.

Fastest: add a simple HTTP gateway (FastAPI) that calls your gRPC service internally.

Or simplest: keep gRPC and build a small CLI chat loop.

If you want a real MVP demo quickly, do the HTTP gateway.

What I need from you (one thing)

Open main.py and search for the code block where it prints:
“Correct answer! Back to QUIZ for retry”
Paste that small block (10–20 lines).
I’ll tell you the exact replacement code to implement the correct flow (next question, no retry).